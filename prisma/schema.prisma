generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ─── Casino Domain ───────────────────────────────────────────────

model CasinoUser {
  id        Int      @id @default(autoincrement())
  username  String   @db.VarChar(100)
  email     String   @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at")

  wallet   CasinoWallet?
  sessions CasinoGameSession[]

  @@map("casino_users")
}

model CasinoWallet {
  id                Int      @id @default(autoincrement())
  userId            Int      @unique @map("user_id")
  currencyCode      String   @map("currency_code") @db.VarChar(10)
  playableBalance   BigInt   @default(0) @map("playable_balance")
  redeemableBalance BigInt   @default(0) @map("redeemable_balance")
  updatedAt         DateTime @updatedAt @map("updated_at")

  user         CasinoUser          @relation(fields: [userId], references: [id])
  sessions     CasinoGameSession[]
  transactions CasinoTransaction[]

  @@map("casino_wallets")
}

model CasinoGameProvider {
  id          Int      @id @default(autoincrement())
  code        String   @unique @db.VarChar(50)
  name        String   @db.VarChar(100)
  apiEndpoint String   @map("api_endpoint") @db.VarChar(500)
  secretKey   String   @map("secret_key") @db.VarChar(500)
  isDisabled  Boolean  @default(false) @map("is_disabled")
  createdAt   DateTime @default(now()) @map("created_at")

  games CasinoGame[]

  @@map("casino_game_providers")
}

model CasinoGame {
  id             Int      @id @default(autoincrement())
  providerId     Int      @map("provider_id")
  providerGameId String   @map("provider_game_id") @db.VarChar(100)
  isActive       Boolean  @default(true) @map("is_active")
  minBet         BigInt   @default(100) @map("min_bet")
  maxBet         BigInt   @default(100000) @map("max_bet")
  createdAt      DateTime @default(now()) @map("created_at")

  provider CasinoGameProvider @relation(fields: [providerId], references: [id])
  sessions CasinoGameSession[]

  @@map("casino_games")
}

model CasinoGameSession {
  id                Int      @id @default(autoincrement())
  token             String   @unique @db.VarChar(255)
  userId            Int      @map("user_id")
  walletId          Int      @map("wallet_id")
  gameId            Int      @map("game_id")
  providerSessionId String?  @map("provider_session_id") @db.VarChar(255)
  isActive          Boolean  @default(true) @map("is_active")
  createdAt         DateTime @default(now()) @map("created_at")

  user         CasinoUser          @relation(fields: [userId], references: [id])
  wallet       CasinoWallet        @relation(fields: [walletId], references: [id])
  game         CasinoGame          @relation(fields: [gameId], references: [id])
  transactions CasinoTransaction[]

  @@map("casino_game_sessions")
}

model CasinoTransaction {
  id                           Int      @id @default(autoincrement())
  walletId                     Int      @map("wallet_id")
  sessionId                    Int      @map("session_id")
  transactionType              String   @map("transaction_type") @db.VarChar(20)
  amount                       BigInt
  externalTransactionId        String   @unique @map("external_transaction_id") @db.VarChar(255)
  externalRoundId              String?  @map("external_round_id") @db.VarChar(255)
  relatedExternalTransactionId String?  @map("related_external_transaction_id") @db.VarChar(255)
  balanceAfter                 BigInt   @map("balance_after")
  responseCache                Json?    @map("response_cache")
  createdAt                    DateTime @default(now()) @map("created_at")

  wallet  CasinoWallet     @relation(fields: [walletId], references: [id])
  session CasinoGameSession @relation(fields: [sessionId], references: [id])

  @@map("casino_transactions")
}

// ─── Provider Domain ─────────────────────────────────────────────

model ProviderGame {
  id        Int      @id @default(autoincrement())
  gameId    String   @unique @map("game_id") @db.VarChar(100)
  isActive  Boolean  @default(true) @map("is_active")
  minBet    BigInt   @default(100) @map("min_bet")
  maxBet    BigInt   @default(100000) @map("max_bet")
  createdAt DateTime @default(now()) @map("created_at")

  rounds ProviderGameRound[]

  @@map("provider_games")
}

model ProviderCasino {
  id                Int      @id @default(autoincrement())
  casinoCode        String   @unique @map("casino_code") @db.VarChar(50)
  name              String   @db.VarChar(100)
  casinoApiEndpoint String   @map("casino_api_endpoint") @db.VarChar(500)
  casinoSecret      String   @map("casino_secret") @db.VarChar(500)
  isActive          Boolean  @default(true) @map("is_active")
  createdAt         DateTime @default(now()) @map("created_at")

  users  ProviderCasinoUser[]
  rounds ProviderGameRound[]
  bets   ProviderBet[]

  @@map("provider_casinos")
}

model ProviderCasinoUser {
  id           Int      @id @default(autoincrement())
  casinoId     Int      @map("casino_id")
  casinoUserId Int      @map("casino_user_id")
  playerKey    String   @unique @map("player_key") @db.VarChar(255)
  createdAt    DateTime @default(now()) @map("created_at")

  casino ProviderCasino      @relation(fields: [casinoId], references: [id])
  rounds ProviderGameRound[]

  @@map("provider_casino_users")
}

model ProviderGameRound {
  id                   Int      @id @default(autoincrement())
  roundId              String   @unique @map("round_id") @db.VarChar(255)
  sessionId            String   @map("session_id") @db.VarChar(255)
  casinoId             Int      @map("casino_id")
  casinoUserId         Int      @map("casino_user_id")
  providerCasinoUserId Int      @map("provider_casino_user_id")
  gameId               Int      @map("game_id")
  currency             String   @db.VarChar(10)
  status               String   @default("open") @db.VarChar(20)
  totalBetAmount       BigInt   @default(0) @map("total_bet_amount")
  totalPayoutAmount    BigInt   @default(0) @map("total_payout_amount")
  createdAt            DateTime @default(now()) @map("created_at")

  casino             ProviderCasino     @relation(fields: [casinoId], references: [id])
  providerCasinoUser ProviderCasinoUser @relation(fields: [providerCasinoUserId], references: [id])
  game               ProviderGame       @relation(fields: [gameId], references: [id])
  bets               ProviderBet[]

  @@map("provider_game_rounds")
}

model ProviderBet {
  id                 Int      @id @default(autoincrement())
  transactionId      String   @unique @map("transaction_id") @db.VarChar(255)
  roundId            Int      @map("round_id")
  casinoId           Int      @map("casino_id")
  casinoUserId       Int      @map("casino_user_id")
  betType            String   @map("bet_type") @db.VarChar(20)
  amount             BigInt
  casinoBalanceAfter BigInt?  @map("casino_balance_after")
  status             String   @default("pending") @db.VarChar(20)
  responseCache      Json?    @map("response_cache")
  createdAt          DateTime @default(now()) @map("created_at")

  round  ProviderGameRound @relation(fields: [roundId], references: [id])
  casino ProviderCasino    @relation(fields: [casinoId], references: [id])

  @@map("provider_bets")
}
